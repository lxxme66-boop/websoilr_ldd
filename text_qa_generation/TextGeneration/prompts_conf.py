system_prompt = """
你是一位半导体和显示技术领域的资深专家，特别擅长IGZO、TFT、OLED等相关技术。你需要基于提供的技术文档内容，提取关键信息并生成高质量的问答对。

你的专业领域包括：
1. 氧化物半导体材料（IGZO、IGO、ITO等）
2. 薄膜晶体管（TFT）器件结构与制造
3. 显示技术（LCD、OLED、Mini-LED等）
4. 半导体器件物理与可靠性
5. 制造工艺与优化

请确保生成的内容准确、专业、有深度。
"""

user_prompts = {
    # 文本分析和知识提取
    9: """
请仔细阅读以下技术文档内容，提取其中的关键技术信息，并整理成结构化的知识点。

文档内容：
{text_content}

来源文件：{source_file} {chunk_info}

请按以下格式输出：
```json
{{
    "key_concepts": ["列出3-5个核心概念或技术术语"],
    "technical_details": {{
        "materials": ["涉及的材料"],
        "parameters": ["关键参数和数值"],
        "methods": ["技术方法或工艺"]
    }},
    "main_findings": ["主要发现或结论"],
    "context": "简要总结文档的技术背景和应用场景"
}}
```
""",

    # QA对生成 - 事实型问题
    43: """
基于以下技术文档内容，生成事实型问答对。事实型问题应该询问具体的参数、数值、材料特性等客观信息。

文档内容：
{text_content}

请生成3个高质量的事实型问答对，格式如下：
```json
{{
    "qa_pairs": [
        {{
            "question": "具体的事实型问题",
            "answer": "准确的答案",
            "question_type": "factual",
            "context": "相关上下文"
        }}
    ]
}}
```

参考示例：
- JDI开发IGO材料的迁移率是多少？
- IGZO TFT的典型阈值电压范围是什么？
- 制备IGZO薄膜常用的溅射功率是多少？
""",

    # QA对生成 - 比较型问题
    44: """
基于以下技术文档内容，生成比较型问答对。比较型问题应该对比不同材料、结构或方案的差异。

文档内容：
{text_content}

请生成2个高质量的比较型问答对，格式如下：
```json
{{
    "qa_pairs": [
        {{
            "question": "比较不同方案的问题",
            "answer": "详细的比较分析",
            "question_type": "comparison",
            "reasoning": "比较的依据和逻辑"
        }}
    ]
}}
```

参考示例：
- 顶栅结构的IGZO TFT相比底栅结构有什么优势？
- a-IGZO与c-IGZO在电学性能上有何差异？
""",

    # QA对生成 - 推理型问题
    45: """
基于以下技术文档内容，生成推理型问答对。推理型问题应该探究机制原理、解释现象成因。

文档内容：
{text_content}

请生成5个高质量的推理型问答对，格式如下：
```json
{{
    "qa_pairs": [
        {{
            "question": "探究原理或机制的问题",
            "answer": "深入的机理解释",
            "question_type": "reasoning",
            "reasoning": "详细的推理过程"
        }}
    ]
}}
```

参考示例：
- 在IGZO TFT中，环境气氛中的氧气是如何影响TFT的阈值电压的？
- 为什么增加氧空位会导致IGZO迁移率的变化？
- SiNx覆盖层如何影响IGZO薄膜的电阻率？
""",

    # QA对生成 - 开放型问题
    46: """
基于以下技术文档内容，生成开放型问答对。开放型问题应该提出优化建议或改进方案。

文档内容：
{text_content}

请生成2个高质量的开放型问答对，格式如下：
```json
{{
    "qa_pairs": [
        {{
            "question": "寻求解决方案的开放性问题",
            "answer": "系统性的解决方案和建议",
            "question_type": "open_ended",
            "reasoning": "方案的理论依据"
        }}
    ]
}}
```

参考示例：
- 怎么实现短沟道的顶栅氧化物TFT器件且同时避免器件失效？
- 金属氧化物背板在短时间内驱动OLED显示时会出现残影，请问如何在TFT方面改善残影问题？
""",

    # 综合QA生成
    343: """
基于以下技术文档内容，生成多种类型的高质量问答对。

文档内容：
{text_content}

请按照以下比例生成问答对：
- 事实型（15%）：询问具体参数、数值、性能指标
- 比较型（15%）：比较不同材料、结构或方案
- 推理型（50%）：探究机制原理、解释现象
- 开放型（20%）：提出优化建议或改进方案

输出格式：
```json
{{
    "qa_pairs": [
        {{
            "question": "问题内容",
            "answer": "答案内容",
            "question_type": "类型（factual/comparison/reasoning/open_ended）",
            "reasoning": "推理过程或解释（如适用）",
            "context": "相关背景信息"
        }}
    ],
    "summary": "文档核心内容总结"
}}
```

确保问题专业、答案准确、推理清晰。
"""
}

# 额外的专业问题模板，用于增强开放型问题
open_ended_templates = [
    "怎么实现短沟道的顶栅氧化物TFT器件且同时避免器件失效？",
    "金属氧化物背板在短时间内驱动OLED显示时会出现残影，请问如何在TFT方面改善残影问题？",
    "在高分辨率显示应用中，如何优化IGZO TFT的均匀性和稳定性？",
    "针对柔性显示应用，如何改进氧化物TFT的机械可靠性？",
    "在大尺寸OLED面板制造中，如何解决TFT背板的IR drop问题？",
    "如何通过材料和工艺优化来降低IGZO TFT的光敏感性？",
    "在低温多晶硅无法应用的场景下，如何提升氧化物TFT的性能以满足高端显示需求？",
    "面对氢致退化问题，如何改进IGZO TFT的封装和钝化层设计？"
]